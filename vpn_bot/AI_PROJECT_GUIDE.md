—Å—Ç–∞—Ä–∞—è –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—è, –Ω–æ —Ç–æ–∂–µ –æ—á–µ–Ω—å –≤–∞–∂–Ω–∞—è
# VPN Bot - –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –¥–ª—è —Å–ª–µ–¥—É—é—â–µ–π —Å–µ—Å—Å–∏–∏

## –ü—Ä–æ–µ–∫—Ç
Telegram –±–æ—Ç –¥–ª—è WireGuard VPN: `@agdevpnbot`

## –°—Ç—Ä—É–∫—Ç—É—Ä–∞
- **–ü—É—Ç—å**: `/Users/agdelesha/Desktop/myScripts/wgScript/vpn_bot/`
- **–°–µ—Ä–≤–µ—Ä**: `root@83.217.9.75:/root/vpn_bot/`
- **–°–µ—Ä–≤–∏—Å**: `systemctl restart vpn-bot`

## –¢–µ—Ö–Ω–æ–ª–æ–≥–∏–∏
- Python 3.8, aiogram 3.x
- SQLAlchemy async (SQLite)
- WireGuard VPN

## –ö–ª—é—á–µ–≤—ã–µ —Ñ–∞–π–ª—ã
- `bot.py` - —Ç–æ—á–∫–∞ –≤—Ö–æ–¥–∞
- `handlers/user.py` - –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏–µ –∫–æ–º–∞–Ω–¥—ã
- `handlers/admin.py` - –∞–¥–º–∏–Ω-–ø–∞–Ω–µ–ª—å
- `services/wireguard.py` - —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ WireGuard
- `services/settings.py` - –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –±–æ—Ç–∞

## –î–µ–ø–ª–æ–π
```bash
scp vpn_bot/handlers/admin.py root@83.217.9.75:/root/vpn_bot/handlers/
ssh root@83.217.9.75 "systemctl restart vpn-bot"
```

## –ò–∑–≤–µ—Å—Ç–Ω—ã–µ –æ—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏

### Markdown –≤ —Å–æ–æ–±—â–µ–Ω–∏—è—Ö
- –ò–º–µ–Ω–∞ –∫–æ–Ω—Ñ–∏–≥–æ–≤ –º–æ–≥—É—Ç —Å–æ–¥–µ—Ä–∂–∞—Ç—å –ø–æ–¥—á—ë—Ä–∫–∏–≤–∞–Ω–∏—è (`agdelesha_2`)
- –≠—Ç–æ –ª–æ–º–∞–µ—Ç Markdown —Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ
- –†–µ—à–µ–Ω–∏–µ: –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å `parse_mode=None` –≥–¥–µ –≤—ã–≤–æ–¥—è—Ç—Å—è –∏–º–µ–Ω–∞ –∫–æ–Ω—Ñ–∏–≥–æ–≤
- –ü—Ä–∏–º–µ—Ä –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è –≤ `admin_user_detail` (—Å—Ç—Ä–æ–∫–∞ ~160)

### –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –∫–æ–Ω—Ñ–∏–≥–∏
- –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –∑–∞–ø—Ä–∞—à–∏–≤–∞–µ—Ç –¥–æ–ø. –∫–æ–Ω—Ñ–∏–≥ ‚Üí –≤–≤–æ–¥–∏—Ç –Ω–∞–∑–≤–∞–Ω–∏–µ —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞
- –ê–¥–º–∏–Ω –æ–¥–æ–±—Ä—è–µ—Ç ‚Üí –∫–æ–Ω—Ñ–∏–≥ —Å–æ–∑–¥–∞—ë—Ç—Å—è —Å –∏–º–µ–Ω–µ–º `username + device`
- –ö–æ–¥ –≤ `admin.py` —Ñ—É–Ω–∫—Ü–∏—è `admin_approve_config_request`
- –ù–∞–∑–≤–∞–Ω–∏–µ —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞ –∏–∑–≤–ª–µ–∫–∞–µ—Ç—Å—è regex –∏–∑ —Å–æ–æ–±—â–µ–Ω–∏—è –∞–¥–º–∏–Ω—É

### –ú–∏–≥–∞–Ω–∏–µ –∫–Ω–æ–ø–æ–∫
- –°—Ç–∞–Ω–¥–∞—Ä—Ç–Ω–æ–µ –ø–æ–≤–µ–¥–µ–Ω–∏–µ Telegram –ø—Ä–∏ —Å–º–µ–Ω–µ –∫–ª–∞–≤–∏–∞—Ç—É—Ä—ã
- –ü–æ–ø—ã—Ç–∫–∞ –¥–æ–±–∞–≤–∏—Ç—å middleware –¥–ª—è `callback.answer()` —Å–ª–æ–º–∞–ª–∞ –±–æ—Ç–∞
- `CallbackQuery` –≤ aiogram 3.x –Ω–µ –∏–º–µ–µ—Ç –∞—Ç—Ä–∏–±—É—Ç–∞ `answered`
- –û—Å—Ç–∞–≤–∏–ª–∏ –∫–∞–∫ –µ—Å—Ç—å - —ç—Ç–æ –Ω–µ –∫—Ä–∏—Ç–∏—á–Ω–æ

## –ü–æ—Å–ª–µ–¥–Ω–∏–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è (23.12.2024)
1. –¢–∞—Ä–∏—Ñ—ã: –∏–∑–º–µ–Ω—ë–Ω —Ç–µ–∫—Å—Ç –Ω–∞ "30/90/180 –¥–Ω–µ–π" –≤–º–µ—Å—Ç–æ "–º–µ—Å—è—Ü–µ–≤"
2. –£–±—Ä–∞–Ω Markdown –∏–∑ `admin_user_detail` (parse_mode=None)
3. –ö–æ–Ω—Ñ–∏–≥–∏ –Ω–∞–∑—ã–≤–∞—é—Ç—Å—è `username + device` (–±–µ–∑ –ø–æ–¥—á—ë—Ä–∫–∏–≤–∞–Ω–∏—è –º–µ–∂–¥—É –Ω–∏–º–∏)

## GitHub
https://github.com/agdelesha/agdevpnbot






# VPN Telegram Bot ‚Äî –ü–æ–ª–Ω–∞—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è –¥–ª—è AI-–∞—Å—Å–∏—Å—Ç–µ–Ω—Ç–∞

## üéØ –û–±–∑–æ—Ä –ø—Ä–æ–µ–∫—Ç–∞

**VPN Telegram Bot** ‚Äî —ç—Ç–æ Telegram-–±–æ—Ç –¥–ª—è –ø—Ä–æ–¥–∞–∂–∏ –∏ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è WireGuard VPN –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è–º–∏. –ë–æ—Ç –∞–≤—Ç–æ–º–∞—Ç–∏–∑–∏—Ä—É–µ—Ç –ø—Ä–æ—Ü–µ—Å—Å —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π, –æ–ø–ª–∞—Ç—ã, —Å–æ–∑–¥–∞–Ω–∏—è VPN-–∫–æ–Ω—Ñ–∏–≥–æ–≤ –∏ –ø–æ–¥–¥–µ—Ä–∂–∫–∏ —á–µ—Ä–µ–∑ AI-–∞—Å—Å–∏—Å—Ç–µ–Ω—Ç–∞.

---

## üñ•Ô∏è –°–µ—Ä–≤–µ—Ä–Ω–∞—è –∏–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä–∞

### Production —Å–µ—Ä–≤–µ—Ä
- **IP:** `83.217.9.75`
- **SSH –¥–æ—Å—Ç—É–ø:** `ssh root@83.217.9.75`
- **–ü—É—Ç—å –∫ –±–æ—Ç—É:** `/root/vpn_bot/`
- **–ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö:** `/root/vpn_bot/vpn_bot.db` (SQLite)
- **–õ–æ–≥–∏:** `/root/vpn_bot/bot.log`

### –õ–æ–∫–∞–ª—å–Ω–∞—è —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∞
- **–ü—É—Ç—å:** `/Users/agdelesha/Desktop/myScripts/wgScript/vpn_bot/`
- **–†–µ–∂–∏–º:** `LOCAL_MODE=true` –≤ `.env`

---

## üîë –ö–ª—é—á–∏ –∏ –¥–æ—Å—Ç—É–ø—ã

### Telegram Bot
- **Bot Token:** `[–ó–ê–î–ê–¢–¨ –í .env]`
- **Bot Username:** `@agdevpnbot`
- **Admin Telegram ID:** `906888481`
- **–ö–∞–Ω–∞–ª –¥–ª—è –ø–æ–¥–ø–∏—Å–∫–∏:** `@agdevpn`

### DeepSeek AI API
- **API Key:** `[–ó–ê–î–ê–¢–¨ –í .env]`
- **API URL:** `https://api.deepseek.com/v1/chat/completions`
- **–ú–æ–¥–µ–ª—å:** `deepseek-chat`

### –ü–ª–∞—Ç—ë–∂–Ω—ã–µ —Ä–µ–∫–≤–∏–∑–∏—Ç—ã
- **–¢–µ–ª–µ—Ñ–æ–Ω –¥–ª—è –æ–ø–ª–∞—Ç—ã:** `89992115019`

---

## üìÅ –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞

```
vpn_bot/
‚îú‚îÄ‚îÄ bot.py                 # –¢–æ—á–∫–∞ –≤—Ö–æ–¥–∞, –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –±–æ—Ç–∞
‚îú‚îÄ‚îÄ config.py              # –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –∏–∑ .env
‚îú‚îÄ‚îÄ utils.py               # –û–±—â–∏–µ —É—Ç–∏–ª–∏—Ç—ã (transliterate_ru_to_en)
‚îú‚îÄ‚îÄ .env                   # –°–µ–∫—Ä–µ—Ç—ã (–Ω–µ –≤ git)
‚îú‚îÄ‚îÄ .env.example           # –ü—Ä–∏–º–µ—Ä .env
‚îú‚îÄ‚îÄ vpn_bot.db             # SQLite –±–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö
‚îÇ
‚îú‚îÄ‚îÄ database/
‚îÇ   ‚îú‚îÄ‚îÄ __init__.py        # –≠–∫—Å–ø–æ—Ä—Ç –º–æ–¥–µ–ª–µ–π –∏ —Å–µ—Å—Å–∏–∏
‚îÇ   ‚îú‚îÄ‚îÄ db.py              # –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è async SQLAlchemy
‚îÇ   ‚îî‚îÄ‚îÄ models.py          # ORM –º–æ–¥–µ–ª–∏ (User, Config, Subscription, Payment, Settings)
‚îÇ
‚îú‚îÄ‚îÄ handlers/
‚îÇ   ‚îú‚îÄ‚îÄ __init__.py        # –≠–∫—Å–ø–æ—Ä—Ç —Ä–æ—É—Ç–µ—Ä–æ–≤
‚îÇ   ‚îú‚îÄ‚îÄ user.py            # –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è (~1660 —Å—Ç—Ä–æ–∫)
‚îÇ   ‚îî‚îÄ‚îÄ admin.py           # –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –∞–¥–º–∏–Ω–∞ (~1960 —Å—Ç—Ä–æ–∫)
‚îÇ
‚îú‚îÄ‚îÄ keyboards/
‚îÇ   ‚îú‚îÄ‚îÄ __init__.py
‚îÇ   ‚îú‚îÄ‚îÄ user_kb.py         # –ö–ª–∞–≤–∏–∞—Ç—É—Ä—ã –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
‚îÇ   ‚îî‚îÄ‚îÄ admin_kb.py        # –ö–ª–∞–≤–∏–∞—Ç—É—Ä—ã –∞–¥–º–∏–Ω–∞
‚îÇ
‚îú‚îÄ‚îÄ services/
‚îÇ   ‚îú‚îÄ‚îÄ __init__.py
‚îÇ   ‚îú‚îÄ‚îÄ wireguard.py       # WireGuard API (—Å–æ–∑–¥–∞–Ω–∏–µ/—É–¥–∞–ª–µ–Ω–∏–µ –∫–æ–Ω—Ñ–∏–≥–æ–≤)
‚îÇ   ‚îú‚îÄ‚îÄ ocr.py             # OCR –¥–ª—è —Ä–∞—Å–ø–æ–∑–Ω–∞–≤–∞–Ω–∏—è —á–µ–∫–æ–≤
‚îÇ   ‚îú‚îÄ‚îÄ scheduler.py       # –ü–ª–∞–Ω–∏—Ä–æ–≤—â–∏–∫ (—É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –æ–± –∏—Å—Ç–µ—á–µ–Ω–∏–∏ –ø–æ–¥–ø–∏—Å–∫–∏)
‚îÇ   ‚îú‚îÄ‚îÄ settings.py        # –î–∏–Ω–∞–º–∏—á–µ—Å–∫–∏–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –∏–∑ –ë–î
‚îÇ   ‚îî‚îÄ‚îÄ ai_assistant.py    # DeepSeek AI –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è
‚îÇ
‚îî‚îÄ‚îÄ states/
    ‚îú‚îÄ‚îÄ __init__.py
    ‚îî‚îÄ‚îÄ user_states.py     # FSM —Å–æ—Å—Ç–æ—è–Ω–∏—è
```

---

## üóÑÔ∏è –ú–æ–¥–µ–ª–∏ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö

### User
```python
- id: int (PK)
- telegram_id: int (unique)
- username: str (nullable)
- full_name: str
- phone: str (nullable)
- created_at: datetime
- trial_used: bool (default False)
- is_blocked: bool (default False)
- how_to_seen: bool (default False)
```

### Config
```python
- id: int (PK)
- user_id: int (FK -> users.id)
- name: str (unique) ‚Äî –∏–º—è –∫–æ–Ω—Ñ–∏–≥–∞ (–Ω–∞–ø—Ä–∏–º–µ—Ä: "agdelesha_iphone")
- public_key: str
- preshared_key: str
- allowed_ips: str
- client_ip: str
- is_active: bool (default True)
- created_at: datetime
```

### Subscription
```python
- id: int (PK)
- user_id: int (FK -> users.id)
- tariff_type: str ("trial", "30", "90", "180", "unlimited")
- days_total: int
- expires_at: datetime (nullable –¥–ª—è unlimited)
- is_gift: bool (default False)
- created_at: datetime
- notified_3_days: bool (default False)
```

### Payment
```python
- id: int (PK)
- user_id: int (FK -> users.id)
- tariff_type: str
- amount: int
- receipt_file_id: str
- ocr_result: str (nullable)
- status: str ("pending", "approved", "rejected")
- admin_comment: str (nullable)
- created_at: datetime
- processed_at: datetime (nullable)
```

### Settings
```python
- id: int (PK)
- key: str (unique)
- value: str
```

**–ò—Å–ø–æ–ª—å–∑—É–µ–º—ã–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏:**
- `password_required` ‚Äî —Ç—Ä–µ–±–æ–≤–∞—Ç—å –ø–∞—Ä–æ–ª—å –ø—Ä–∏ –≤—Ö–æ–¥–µ (true/false)
- `bot_password` ‚Äî –ø–∞—Ä–æ–ª—å –¥–ª—è –≤—Ö–æ–¥–∞
- `channel_required` ‚Äî —Ç—Ä–µ–±–æ–≤–∞—Ç—å –ø–æ–¥–ø–∏—Å–∫—É –Ω–∞ –∫–∞–Ω–∞–ª (true/false)
- `phone_required` ‚Äî —Ç—Ä–µ–±–æ–≤–∞—Ç—å –Ω–æ–º–µ—Ä —Ç–µ–ª–µ—Ñ–æ–Ω–∞ (true/false)
- `config_approval_required` ‚Äî —Ç—Ä–µ–±–æ–≤–∞—Ç—å –æ–¥–æ–±—Ä–µ–Ω–∏–µ –∞–¥–º–∏–Ω–∞ –¥–ª—è –∫–æ–Ω—Ñ–∏–≥–æ–≤ (true/false)

---

## üîÑ –û—Å–Ω–æ–≤–Ω—ã–µ flow –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è

### 1. –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è –Ω–æ–≤–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
1. `/start` ‚Üí –ø—Ä–æ–≤–µ—Ä–∫–∞ –ø–∞—Ä–æ–ª—è (–µ—Å–ª–∏ –≤–∫–ª—é—á–µ–Ω–æ)
2. –ó–∞–ø—Ä–æ—Å —Ç–µ–ª–µ—Ñ–æ–Ω–∞ (–µ—Å–ª–∏ –≤–∫–ª—é—á–µ–Ω–æ)
3. –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ–¥–ø–∏—Å–∫–∏ –Ω–∞ –∫–∞–Ω–∞–ª (–µ—Å–ª–∏ –≤–∫–ª—é—á–µ–Ω–æ)
4. –ü–æ–∫–∞–∑ –ø—Ä–∏–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ–≥–æ –º–µ–Ω—é —Å –∫–Ω–æ–ø–∫–∞–º–∏ "–ü—Ä–æ–±–Ω—ã–π –¥–æ—Å—Ç—É–ø" / "–¢–∞—Ä–∏—Ñ—ã"

### 2. –ê–∫—Ç–∏–≤–∞—Ü–∏—è –ø—Ä–æ–±–Ω–æ–≥–æ –ø–µ—Ä–∏–æ–¥–∞
1. –ù–∞–∂–∞—Ç–∏–µ "–ü—Ä–æ–±–Ω—ã–π –¥–æ—Å—Ç—É–ø"
2. –°–æ–∑–¥–∞–Ω–∏–µ –ø–æ–¥–ø–∏—Å–∫–∏ –Ω–∞ 7 –¥–Ω–µ–π
3. –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ —Å–æ–∑–¥–∞–Ω–∏–µ WireGuard –∫–æ–Ω—Ñ–∏–≥–∞
4. –û—Ç–ø—Ä–∞–≤–∫–∞ —Ñ–∞–π–ª–∞ –∫–æ–Ω—Ñ–∏–≥–∞ + QR-–∫–æ–¥

### 3. –ü–æ–∫—É–ø–∫–∞ –ø–æ–¥–ø–∏—Å–∫–∏
1. –í—ã–±–æ—Ä —Ç–∞—Ä–∏—Ñ–∞ (30/90/180 –¥–Ω–µ–π)
2. –ü–æ–∫–∞–∑ —Ä–µ–∫–≤–∏–∑–∏—Ç–æ–≤ –¥–ª—è –æ–ø–ª–∞—Ç—ã
3. –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç —Å–∫—Ä–∏–Ω—à–æ—Ç —á–µ–∫–∞
4. OCR —Ä–∞—Å–ø–æ–∑–Ω–∞—ë—Ç —Å—É–º–º—É –∏ –ø—Ä–æ–≤–µ—Ä—è–µ—Ç
5. –ï—Å–ª–∏ —Å—É–º–º–∞ —Å–æ–≤–ø–∞–¥–∞–µ—Ç ‚Äî –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ
6. –ï—Å–ª–∏ –Ω–µ—Ç ‚Äî –æ—Ç–ø—Ä–∞–≤–∫–∞ –∞–¥–º–∏–Ω—É –Ω–∞ –ø—Ä–æ–≤–µ—Ä–∫—É

### 4. AI-–∞—Å—Å–∏—Å—Ç–µ–Ω—Ç
- –õ—é–±–æ–µ —Ç–µ–∫—Å—Ç–æ–≤–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç—Å—è AI
- AI –º–æ–∂–µ—Ç –≤—ã–ø–æ–ª–Ω—è—Ç—å –¥–µ–π—Å—Ç–≤–∏—è: `activate_trial`, `show_tariffs`, `show_configs`, `show_subscription`, `create_config`
- –ò—Å—Ç–æ—Ä–∏—è –¥–∏–∞–ª–æ–≥–∞ —Ö—Ä–∞–Ω–∏—Ç—Å—è –≤ –ø–∞–º—è—Ç–∏ (–¥–æ 10 —Å–æ–æ–±—â–µ–Ω–∏–π –Ω–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è)

---

## üõ†Ô∏è –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏–π —Å—Ç–µ–∫

- **Python 3.11+**
- **aiogram 3.x** ‚Äî Telegram Bot API
- **SQLAlchemy 2.x** ‚Äî ORM (async)
- **aiosqlite** ‚Äî async SQLite –¥—Ä–∞–π–≤–µ—Ä
- **aiohttp** ‚Äî HTTP –∫–ª–∏–µ–Ω—Ç –¥–ª—è DeepSeek API
- **APScheduler** ‚Äî –ø–ª–∞–Ω–∏—Ä–æ–≤—â–∏–∫ –∑–∞–¥–∞—á
- **python-dotenv** ‚Äî –∑–∞–≥—Ä—É–∑–∫–∞ .env
- **qrcode** ‚Äî –≥–µ–Ω–µ—Ä–∞—Ü–∏—è QR-–∫–æ–¥–æ–≤

---

## üîß WireGuard –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è

### –°–∫—Ä–∏–ø—Ç—ã –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ
- **–°–æ–∑–¥–∞–Ω–∏–µ –∫–æ–Ω—Ñ–∏–≥–∞:** `/usr/local/bin/wg-new-conf.sh <name>`
- **–£–¥–∞–ª–µ–Ω–∏–µ –∫–æ–Ω—Ñ–∏–≥–∞:** `/usr/local/bin/wg-remove-client.sh <name>`

### –ü—É—Ç–∏ –∫ —Ñ–∞–π–ª–∞–º
- **–ö–æ–Ω—Ñ–∏–≥–∏:** `/etc/wireguard/clients/<name>.conf`
- **QR-–∫–æ–¥—ã:** `/etc/wireguard/clients/<name>.png`
- **–û—Å–Ω–æ–≤–Ω–æ–π –∫–æ–Ω—Ñ–∏–≥ WG:** `/etc/wireguard/wg0.conf`

### –§–æ—Ä–º–∞—Ç –∏–º–µ–Ω–∏ –∫–æ–Ω—Ñ–∏–≥–∞
`<username><device>` ‚Äî –Ω–∞–ø—Ä–∏–º–µ—Ä: `agdeleshaiphone`, `user123macbook`

---

## üìã –¢–∞—Ä–∏—Ñ—ã

```python
TARIFFS = {
    "trial": {"days": 7, "price": 0, "name": "7 –¥–Ω–µ–π"},
    "30": {"days": 30, "price": 100, "name": "30 –¥–Ω–µ–π"},
    "90": {"days": 90, "price": 200, "name": "90 –¥–Ω–µ–π"},
    "180": {"days": 180, "price": 300, "name": "180 –¥–Ω–µ–π"},
    "unlimited": {"days": 0, "price": 0, "name": "–ë–µ—Å—Å—Ä–æ—á–Ω—ã–π"},
}
```

---

## ü§ñ AI-–∞—Å—Å–∏—Å—Ç–µ–Ω—Ç (DeepSeek)

### –§–∞–π–ª: `services/ai_assistant.py`

### –°–∏—Å—Ç–µ–º–Ω—ã–π –ø—Ä–æ–º–ø—Ç
AI –∑–Ω–∞–µ—Ç –æ VPN-—Å–µ—Ä–≤–∏—Å–µ, —Ç–∞—Ä–∏—Ñ–∞—Ö, –º–æ–∂–µ—Ç –ø–æ–º–æ—á—å —Å –Ω–∞—Å—Ç—Ä–æ–π–∫–æ–π WireGuard –∏ –æ—Ç–≤–µ—á–∞–µ—Ç –Ω–∞ –≤–æ–ø—Ä–æ—Å—ã –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π.

### –î–æ—Å—Ç—É–ø–Ω—ã–µ –¥–µ–π—Å—Ç–≤–∏—è
- `[ACTION:ACTIVATE_TRIAL]` ‚Äî –∞–∫—Ç–∏–≤–∏—Ä–æ–≤–∞—Ç—å –ø—Ä–æ–±–Ω—ã–π –ø–µ—Ä–∏–æ–¥
- `[ACTION:SHOW_TARIFFS]` ‚Äî –ø–æ–∫–∞–∑–∞—Ç—å —Ç–∞—Ä–∏—Ñ—ã
- `[ACTION:SHOW_CONFIGS]` ‚Äî –ø–æ–∫–∞–∑–∞—Ç—å –∫–æ–Ω—Ñ–∏–≥–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
- `[ACTION:SHOW_SUBSCRIPTION]` ‚Äî –ø–æ–∫–∞–∑–∞—Ç—å —Å—Ç–∞—Ç—É—Å –ø–æ–¥–ø–∏—Å–∫–∏
- `[ACTION:CREATE_CONFIG]` ‚Äî —Å–æ–∑–¥–∞—Ç—å –Ω–æ–≤—ã–π –∫–æ–Ω—Ñ–∏–≥

### –ö–æ–Ω—Ç–µ–∫—Å—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
AI –ø–æ–ª—É—á–∞–µ—Ç –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ:
- `has_subscription` ‚Äî –µ—Å—Ç—å –ª–∏ –∞–∫—Ç–∏–≤–Ω–∞—è –ø–æ–¥–ø–∏—Å–∫–∞
- `days_left` ‚Äî –¥–Ω–µ–π –¥–æ –æ–∫–æ–Ω—á–∞–Ω–∏—è
- `trial_used` ‚Äî –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω –ª–∏ –ø—Ä–æ–±–Ω—ã–π –ø–µ—Ä–∏–æ–¥
- `configs_count` ‚Äî –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –∫–æ–Ω—Ñ–∏–≥–æ–≤

---

## üöÄ –î–µ–ø–ª–æ–π –Ω–∞ —Å–µ—Ä–≤–µ—Ä

### –ó–∞–≥—Ä—É–∑–∫–∞ —Ñ–∞–π–ª–æ–≤
```bash
scp -r vpn_bot/* root@83.217.9.75:/root/vpn_bot/
```

### –ü–µ—Ä–µ–∑–∞–ø—É—Å–∫ –±–æ—Ç–∞
```bash
ssh root@83.217.9.75 "cd /root/vpn_bot && pkill -f 'python.*bot.py'; nohup python3 bot.py > bot.log 2>&1 &"
```

### –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—Ç–∞—Ç—É—Å–∞
```bash
ssh root@83.217.9.75 "ps aux | grep bot.py"
ssh root@83.217.9.75 "tail -50 /root/vpn_bot/bot.log"
```

---

## ‚ö†Ô∏è –í–∞–∂–Ω—ã–µ –æ—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏

### 1. LOCAL_MODE
–í `.env` –µ—Å—Ç—å —Ñ–ª–∞–≥ `LOCAL_MODE=true/false`:
- `true` ‚Äî –±–æ—Ç —Ä–∞–±–æ—Ç–∞–µ—Ç –±–µ–∑ WireGuard (–¥–ª—è –ª–æ–∫–∞–ª—å–Ω–æ–π —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏)
- `false` ‚Äî –±–æ—Ç —Å–æ–∑–¥–∞—ë—Ç —Ä–µ–∞–ª—å–Ω—ã–µ –∫–æ–Ω—Ñ–∏–≥–∏ –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ

### 2. Retry –ª–æ–≥–∏–∫–∞
–í `bot.py` —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω `RetryAiohttpSession` ‚Äî –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–µ –ø–æ–≤—Ç–æ—Ä—ã –ø—Ä–∏ —Å–µ—Ç–µ–≤—ã—Ö –æ—à–∏–±–∫–∞—Ö (5 –ø–æ–ø—ã—Ç–æ–∫).

### 3. –¢—Ä–∞–Ω—Å–ª–∏—Ç–µ—Ä–∞—Ü–∏—è
–§—É–Ω–∫—Ü–∏—è `transliterate_ru_to_en()` –≤ `utils.py` –∫–æ–Ω–≤–µ—Ä—Ç–∏—Ä—É–µ—Ç —Ä—É—Å—Å–∫–∏–µ –±—É–∫–≤—ã –≤ –ª–∞—Ç–∏–Ω–∏—Ü—É –¥–ª—è –∏–º—ë–Ω –∫–æ–Ω—Ñ–∏–≥–æ–≤.

### 4. FSM —Å–æ—Å—Ç–æ—è–Ω–∏—è
```python
RegistrationStates:
    - waiting_for_password
    - waiting_for_phone

PaymentStates:
    - waiting_for_receipt

ConfigRequestStates:
    - waiting_for_device

AdminStates:
    - waiting_for_gift_user
    - waiting_for_config_user
    - waiting_for_new_password
    - waiting_for_traffic_threshold
    - waiting_for_configs_threshold
    - waiting_for_broadcast_all
    - waiting_for_broadcast_user
```

### 5. –ü–ª–∞–Ω–∏—Ä–æ–≤—â–∏–∫ (Scheduler)
–ö–∞–∂–¥—ã–µ 6 —á–∞—Å–æ–≤ –ø—Ä–æ–≤–µ—Ä—è–µ—Ç –ø–æ–¥–ø–∏—Å–∫–∏ –∏ –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –∑–∞ 3 –¥–Ω—è –¥–æ –∏—Å—Ç–µ—á–µ–Ω–∏—è.

---

## üìù –ö–æ–º–∞–Ω–¥—ã –±–æ—Ç–∞

### –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏–µ
- `/start` ‚Äî –≥–ª–∞–≤–Ω–æ–µ –º–µ–Ω—é
- `/about` ‚Äî –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –±–æ—Ç–µ

### –ê–¥–º–∏–Ω—Å–∫–∏–µ
- `/admin` ‚Äî –∞–¥–º–∏–Ω-–ø–∞–Ω–µ–ª—å

---

## üîç –ß–∞—Å—Ç—ã–µ –∑–∞–¥–∞—á–∏

### –î–æ–±–∞–≤–∏—Ç—å –Ω–æ–≤—ã–π —Ç–∞—Ä–∏—Ñ
1. –î–æ–±–∞–≤–∏—Ç—å –≤ `config.py` ‚Üí `TARIFFS`
2. –î–æ–±–∞–≤–∏—Ç—å –∫–Ω–æ–ø–∫—É –≤ `keyboards/user_kb.py` ‚Üí `get_tariffs_kb()`
3. –î–æ–±–∞–≤–∏—Ç—å –æ–±—Ä–∞–±–æ—Ç—á–∏–∫ –≤ `handlers/user.py`

### –ò–∑–º–µ–Ω–∏—Ç—å —Å–∏—Å—Ç–µ–º–Ω—ã–π –ø—Ä–æ–º–ø—Ç AI
–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å `SYSTEM_PROMPT` –≤ `services/ai_assistant.py`

### –î–æ–±–∞–≤–∏—Ç—å –Ω–æ–≤–æ–µ –¥–µ–π—Å—Ç–≤–∏–µ AI
1. –î–æ–±–∞–≤–∏—Ç—å –≤ `SYSTEM_PROMPT` –æ–ø–∏—Å–∞–Ω–∏–µ –¥–µ–π—Å—Ç–≤–∏—è
2. –î–æ–±–∞–≤–∏—Ç—å –ø–∞—Ä—Å–∏–Ω–≥ –≤ `parse_action()`
3. –î–æ–±–∞–≤–∏—Ç—å –æ–±—Ä–∞–±–æ—Ç–∫—É –≤ `handle_ai_action()` –≤ `handlers/user.py`

### –î–æ–±–∞–≤–∏—Ç—å –Ω–æ–≤—É—é –Ω–∞—Å—Ç—Ä–æ–π–∫—É
1. –î–æ–±–∞–≤–∏—Ç—å —Ñ—É–Ω–∫—Ü–∏—é –≤ `services/settings.py`
2. –î–æ–±–∞–≤–∏—Ç—å UI –≤ –∞–¥–º–∏–Ω-–ø–∞–Ω–µ–ª–∏ (`handlers/admin.py`, `keyboards/admin_kb.py`)

---

## üêõ –û—Ç–ª–∞–¥–∫–∞

### –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ª–æ–≥–∏ –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ
```bash
ssh root@83.217.9.75 "tail -100 /root/vpn_bot/bot.log"
```

### –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –±–∞–∑—É –¥–∞–Ω–Ω—ã—Ö
```bash
ssh root@83.217.9.75 "sqlite3 /root/vpn_bot/vpn_bot.db '.tables'"
ssh root@83.217.9.75 "sqlite3 /root/vpn_bot/vpn_bot.db 'SELECT * FROM users LIMIT 5;'"
```

### –ü—Ä–æ–≤–µ—Ä–∏—Ç—å WireGuard
```bash
ssh root@83.217.9.75 "wg show"
ssh root@83.217.9.75 "ls /etc/wireguard/clients/"
```

---

## üìä –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –ø—Ä–æ–µ–∫—Ç–∞

- **user.py:** ~1660 —Å—Ç—Ä–æ–∫
- **admin.py:** ~1960 —Å—Ç—Ä–æ–∫
- **ai_assistant.py:** ~237 —Å—Ç—Ä–æ–∫
- **–í—Å–µ–≥–æ:** ~5000+ —Å—Ç—Ä–æ–∫ –∫–æ–¥–∞

---

*–î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è —Å–æ–∑–¥–∞–Ω–∞: 28.12.2024*
