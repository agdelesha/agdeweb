# –ú—É–ª—å—Ç–∏—Å–µ—Ä–≤–µ—Ä–Ω–∞—è –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ VPN-–±–æ—Ç–∞

## –û–±–∑–æ—Ä

–¢–µ–ø–µ—Ä—å –±–æ—Ç –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –∫–ª–∏–µ–Ω—Ç–æ–≤ –ø–æ –Ω–µ—Å–∫–æ–ª—å–∫–∏–º VPN-—Å–µ—Ä–≤–µ—Ä–∞–º. –≠—Ç–æ –ø–æ–∑–≤–æ–ª—è–µ—Ç:
- –†–∞—Å–ø—Ä–µ–¥–µ–ª–∏—Ç—å –Ω–∞–≥—Ä—É–∑–∫—É (20-30 –∫–ª–∏–µ–Ω—Ç–æ–≤ –Ω–∞ —Å–µ—Ä–≤–µ—Ä)
- –°–Ω–∏–∑–∏—Ç—å —Ä–∏—Å–∫ –±–ª–æ–∫–∏—Ä–æ–≤–∫–∏ (–º–µ–Ω—å—à–µ –∫–ª–∏–µ–Ω—Ç–æ–≤ –Ω–∞ –æ–¥–∏–Ω IP)
- –õ–µ–≥–∫–æ –º–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞—Ç—å —Å–µ—Ä–≤–∏—Å

---

## –ë—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç

### 1. –£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ —Å –±–æ—Ç–æ–º

```bash
pip install asyncssh
```

### 2. –î–æ–±–∞–≤–∏—Ç—å –ø–µ—Ä–≤—ã–π —Å–µ—Ä–≤–µ—Ä (—Ç–µ–∫—É—â–∏–π)

–í Telegram –±–æ—Ç–µ:
1. `/admin` ‚Üí "üñ• –°–µ—Ä–≤–µ—Ä—ã" ‚Üí "‚ûï –î–æ–±–∞–≤–∏—Ç—å —Å–µ—Ä–≤–µ—Ä"
2. –í–≤–µ—Å—Ç–∏ –¥–∞–Ω–Ω—ã–µ: `Russia-1|83.217.9.75|<ssh_password>|30`

### 3. –ü–æ–¥–≥–æ—Ç–æ–≤–∏—Ç—å –Ω–æ–≤—ã–π —Å–µ—Ä–≤–µ—Ä

–ù–∞ –Ω–æ–≤–æ–º —Å–µ—Ä–≤–µ—Ä–µ (45.143.203.153):

```bash
# –°–∫–æ–ø–∏—Ä–æ–≤–∞—Ç—å —Å–∫—Ä–∏–ø—Ç —É—Å—Ç–∞–Ω–æ–≤–∫–∏
scp vpn_bot/scripts/setup_wireguard_server.sh root@45.143.203.153:/root/

# –ü–æ–¥–∫–ª—é—á–∏—Ç—å—Å—è –∏ –∑–∞–ø—É—Å—Ç–∏—Ç—å
ssh root@45.143.203.153
chmod +x /root/setup_wireguard_server.sh
/root/setup_wireguard_server.sh
```

### 4. –î–æ–±–∞–≤–∏—Ç—å –Ω–æ–≤—ã–π —Å–µ—Ä–≤–µ—Ä –≤ –±–æ—Ç

–í Telegram:
1. `/admin` ‚Üí "üñ• –°–µ—Ä–≤–µ—Ä—ã" ‚Üí "‚ûï –î–æ–±–∞–≤–∏—Ç—å —Å–µ—Ä–≤–µ—Ä"
2. –í–≤–µ—Å—Ç–∏: `Russia-2|45.143.203.153|CPbOFaueO8446.|30`

---

## –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Å–µ—Ä–≤–µ—Ä–∞–º–∏

### –ê–¥–º–∏–Ω-–ø–∞–Ω–µ–ª—å

`/admin` ‚Üí "üñ• –°–µ—Ä–≤–µ—Ä—ã"

- **–°–ø–∏—Å–æ–∫ —Å–µ—Ä–≤–µ—Ä–æ–≤** ‚Äî –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç –≤—Å–µ —Å–µ—Ä–≤–µ—Ä—ã —Å –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ–º –∫–ª–∏–µ–Ω—Ç–æ–≤
- **–ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ** ‚Äî —Ç–µ—Å—Ç–∏—Ä—É–µ—Ç SSH –∏ WireGuard
- **–í–∫–ª—é—á–∏—Ç—å/–û—Ç–∫–ª—é—á–∏—Ç—å** ‚Äî –≤—Ä–µ–º–µ–Ω–Ω–æ –æ—Ç–∫–ª—é—á–∏—Ç—å —Å–µ—Ä–≤–µ—Ä –æ—Ç —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è
- **–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞** ‚Äî —Ç—Ä–∞—Ñ–∏–∫ –∏ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –ø–∏—Ä–æ–≤
- **–£–¥–∞–ª–∏—Ç—å** ‚Äî —É–¥–∞–ª–∏—Ç—å —Å–µ—Ä–≤–µ—Ä –∏–∑ —Å–∏—Å—Ç–µ–º—ã

### –§–æ—Ä–º–∞—Ç –¥–æ–±–∞–≤–ª–µ–Ω–∏—è —Å–µ—Ä–≤–µ—Ä–∞

```
–∏–º—è|—Ö–æ—Å—Ç|ssh_–ø–∞—Ä–æ–ª—å|–º–∞–∫—Å_–∫–ª–∏–µ–Ω—Ç–æ–≤
```

–ü—Ä–∏–º–µ—Ä—ã:
- `Germany-1|185.123.45.67|mypassword|30`
- `Finland-1|vpn.example.com|secret123|25`

---

## –ê–ª–≥–æ—Ä–∏—Ç–º —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è

–ü—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏ –Ω–æ–≤–æ–≥–æ –∫–æ–Ω—Ñ–∏–≥–∞ –±–æ—Ç:
1. –ù–∞—Ö–æ–¥–∏—Ç –≤—Å–µ –∞–∫—Ç–∏–≤–Ω—ã–µ —Å–µ—Ä–≤–µ—Ä—ã
2. –°—á–∏—Ç–∞–µ—Ç –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –∫–ª–∏–µ–Ω—Ç–æ–≤ –Ω–∞ –∫–∞–∂–¥–æ–º
3. –í—ã–±–∏—Ä–∞–µ—Ç —Å–µ—Ä–≤–µ—Ä —Å –º–∏–Ω–∏–º–∞–ª—å–Ω–æ–π –Ω–∞–≥—Ä—É–∑–∫–æ–π (–∏ —Å–≤–æ–±–æ–¥–Ω—ã–º–∏ —Å–ª–æ—Ç–∞–º–∏)
4. –°–æ–∑–¥–∞—ë—Ç –∫–æ–Ω—Ñ–∏–≥ –Ω–∞ –≤—ã–±—Ä–∞–Ω–Ω–æ–º —Å–µ—Ä–≤–µ—Ä–µ —á–µ—Ä–µ–∑ SSH
5. –°–æ—Ö—Ä–∞–Ω—è–µ—Ç `server_id` –≤ –ë–î –¥–ª—è —Å–≤—è–∑–∏ –∫–æ–Ω—Ñ–∏–≥–∞ —Å —Å–µ—Ä–≤–µ—Ä–æ–º

---

## –ú–∏–≥—Ä–∞—Ü–∏—è —Å—É—â–µ—Å—Ç–≤—É—é—â–∏—Ö –∫–ª–∏–µ–Ω—Ç–æ–≤

–°—É—â–µ—Å—Ç–≤—É—é—â–∏–µ –∫–æ–Ω—Ñ–∏–≥–∏ (–¥–æ –º—É–ª—å—Ç–∏—Å–µ—Ä–≤–µ—Ä–∞) –∏–º–µ—é—Ç `server_id = NULL`.
–û–Ω–∏ –ø—Ä–æ–¥–æ–ª–∂–∞—é—Ç —Ä–∞–±–æ—Ç–∞—Ç—å –Ω–∞ —Ç–µ–∫—É—â–µ–º —Å–µ—Ä–≤–µ—Ä–µ.

–ß—Ç–æ–±—ã –ø—Ä–∏–≤—è–∑–∞—Ç—å –∏—Ö –∫ —Å–µ—Ä–≤–µ—Ä—É:

```python
# –í Python –∫–æ–Ω—Å–æ–ª–∏
from database import async_session, Config, Server
from sqlalchemy import select, update

async def migrate():
    async with async_session() as session:
        # –ü–æ–ª—É—á–∞–µ–º ID –ø–µ—Ä–≤–æ–≥–æ —Å–µ—Ä–≤–µ—Ä–∞
        server = await session.execute(select(Server).limit(1))
        server = server.scalar_one_or_none()
        
        if server:
            await session.execute(
                update(Config)
                .where(Config.server_id == None)
                .values(server_id=server.id)
            )
            await session.commit()
            print(f"–ö–æ–Ω—Ñ–∏–≥–∏ –ø—Ä–∏–≤—è–∑–∞–Ω—ã –∫ —Å–µ—Ä–≤–µ—Ä—É {server.name}")

import asyncio
asyncio.run(migrate())
```

---

## –°—Ç—Ä—É–∫—Ç—É—Ä–∞ —Ñ–∞–π–ª–æ–≤

```
vpn_bot/
‚îú‚îÄ‚îÄ database/
‚îÇ   ‚îî‚îÄ‚îÄ models.py          # + –º–æ–¥–µ–ª—å Server
‚îú‚îÄ‚îÄ services/
‚îÇ   ‚îú‚îÄ‚îÄ wireguard.py       # —Å—Ç–∞—Ä—ã–π —Å–µ—Ä–≤–∏—Å (–ª–æ–∫–∞–ª—å–Ω—ã–π)
‚îÇ   ‚îî‚îÄ‚îÄ wireguard_multi.py # –Ω–æ–≤—ã–π —Å–µ—Ä–≤–∏—Å (SSH)
‚îú‚îÄ‚îÄ handlers/
‚îÇ   ‚îú‚îÄ‚îÄ admin.py           # + —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Å–µ—Ä–≤–µ—Ä–∞–º–∏
‚îÇ   ‚îî‚îÄ‚îÄ user.py            # –æ–±–Ω–æ–≤–ª—ë–Ω –¥–ª—è –º—É–ª—å—Ç–∏—Å–µ—Ä–≤–µ—Ä–∞
‚îú‚îÄ‚îÄ keyboards/
‚îÇ   ‚îî‚îÄ‚îÄ admin_kb.py        # + –∫–ª–∞–≤–∏–∞—Ç—É—Ä—ã —Å–µ—Ä–≤–µ—Ä–æ–≤
‚îú‚îÄ‚îÄ scripts/
‚îÇ   ‚îî‚îÄ‚îÄ setup_wireguard_server.sh  # —É—Å—Ç–∞–Ω–æ–≤–∫–∞ WG –Ω–∞ –Ω–æ–≤—ã–π —Å–µ—Ä–≤–µ—Ä
‚îî‚îÄ‚îÄ MULTISERVER_GUIDE.md   # —ç—Ç–∞ –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—è
```

---

## –ú–æ–¥–µ–ª—å Server

```python
class Server:
    id: int
    name: str              # "Germany-1"
    host: str              # IP –∏–ª–∏ –¥–æ–º–µ–Ω
    ssh_user: str          # "root"
    ssh_port: int          # 22
    ssh_password: str      # –ø–∞—Ä–æ–ª—å SSH
    wg_interface: str      # "wg0"
    wg_conf_path: str      # "/etc/wireguard/wg0.conf"
    client_dir: str        # "/etc/wireguard/clients"
    add_script: str        # "/usr/local/bin/wg-new-conf.sh"
    remove_script: str     # "/usr/local/bin/wg-remove-client.sh"
    max_clients: int       # 30
    is_active: bool        # True
    priority: int          # 0 (–≤—ã—à–µ = –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç–Ω–µ–µ)
```

---

## –¢—Ä–µ–±–æ–≤–∞–Ω–∏—è –∫ —Å–µ—Ä–≤–µ—Ä—É

–ö–∞–∂–¥—ã–π VPN-—Å–µ—Ä–≤–µ—Ä –¥–æ–ª–∂–µ–Ω –∏–º–µ—Ç—å:
- WireGuard —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω –∏ –Ω–∞—Å—Ç—Ä–æ–µ–Ω
- –°–∫—Ä–∏–ø—Ç—ã `/usr/local/bin/wg-new-conf.sh` –∏ `/usr/local/bin/wg-remove-client.sh`
- –î–∏—Ä–µ–∫—Ç–æ—Ä–∏—è `/etc/wireguard/clients/`
- SSH –¥–æ—Å—Ç—É–ø —Å –ø–∞—Ä–æ–ª–µ–º

–ò—Å–ø–æ–ª—å–∑—É–π `scripts/setup_wireguard_server.sh` –¥–ª—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–π –Ω–∞—Å—Ç—Ä–æ–π–∫–∏.

---

## Troubleshooting

### –û—à–∏–±–∫–∞ "–ù–µ—Ç –¥–æ—Å—Ç—É–ø–Ω—ã—Ö —Å–µ—Ä–≤–µ—Ä–æ–≤"
- –î–æ–±–∞–≤—å —Ö–æ—Ç—è –±—ã –æ–¥–∏–Ω —Å–µ—Ä–≤–µ—Ä –≤ –∞–¥–º–∏–Ω-–ø–∞–Ω–µ–ª–∏
- –ü—Ä–æ–≤–µ—Ä—å —á—Ç–æ —Å–µ—Ä–≤–µ—Ä –∞–∫—Ç–∏–≤–µ–Ω (üü¢)
- –ü—Ä–æ–≤–µ—Ä—å —á—Ç–æ –Ω–µ –ø—Ä–µ–≤—ã—à–µ–Ω –ª–∏–º–∏—Ç –∫–ª–∏–µ–Ω—Ç–æ–≤

### –û—à–∏–±–∫–∞ SSH –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è
- –ü—Ä–æ–≤–µ—Ä—å –ø—Ä–∞–≤–∏–ª—å–Ω–æ—Å—Ç—å –ø–∞—Ä–æ–ª—è
- –ü—Ä–æ–≤–µ—Ä—å —á—Ç–æ SSH –ø–æ—Ä—Ç –æ—Ç–∫—Ä—ã—Ç
- –ü—Ä–æ–≤–µ—Ä—å —á—Ç–æ —Å–µ—Ä–≤–µ—Ä –¥–æ—Å—Ç—É–ø–µ–Ω: `ssh root@<host>`

### WireGuard –Ω–µ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω
- –ó–∞–ø—É—Å—Ç–∏ `setup_wireguard_server.sh` –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ
- –ò–ª–∏ —É—Å—Ç–∞–Ω–æ–≤–∏ –≤—Ä—É—á–Ω—É—é: `apt install wireguard qrencode`

---

## –°–ª–µ–¥—É—é—â–∏–µ —à–∞–≥–∏ (—Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏)

1. **–û–±—Ñ—É—Å–∫–∞—Ü–∏—è —Ç—Ä–∞—Ñ–∏–∫–∞** ‚Äî –ø–µ—Ä–µ—Ö–æ–¥ –Ω–∞ VLESS/Reality –¥–ª—è –æ–±—Ö–æ–¥–∞ DPI
2. **–ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥** ‚Äî –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç–∏ —Å–µ—Ä–≤–µ—Ä–æ–≤
3. **–ê–≤—Ç–æ–º–∏–≥—Ä–∞—Ü–∏—è** ‚Äî –ø–µ—Ä–µ–Ω–æ—Å –∫–ª–∏–µ–Ω—Ç–æ–≤ –ø—Ä–∏ –±–ª–æ–∫–∏—Ä–æ–≤–∫–µ —Å–µ—Ä–≤–µ—Ä–∞
4. **CDN** ‚Äî –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ Cloudflare –¥–ª—è –º–∞—Å–∫–∏—Ä–æ–≤–∫–∏

---

*–°–æ–∑–¥–∞–Ω–æ: 29.12.2024*
